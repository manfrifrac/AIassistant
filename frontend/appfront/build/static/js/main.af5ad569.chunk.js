(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{12:function(e,t,n){},13:function(e,t,n){},14:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),a=n(2),c=n.n(a),s=(n(12),n(16));function i(e){let{audioLevel:t,isActive:n}=e;const a=120*(1-Math.min(Math.max(t,0),1)),c=60*Math.min(Math.max(t,0),1),s=Object(o.useMemo)(()=>"\n    M ".concat(150-a," ").concat(150,"\n    C ").concat(150-a," ").concat(150-c,",\n      ").concat(150+a," ").concat(150-c,",\n      ").concat(150+a," ").concat(150,"\n    C ").concat(150+a," ").concat(150+c,",\n      ").concat(150-a," ").concat(150+c,",\n      ").concat(150-a," ").concat(150,"\n    Z\n  ").trim(),[t]);return r.a.createElement("svg",{width:300,height:300,className:"audio-visualizer ".concat(n?"active":""),viewBox:"0 0 ".concat(300," ").concat(300)},r.a.createElement("path",{d:s,className:"wave-path",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"}))}class u{constructor(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=.3,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),this.prevLevel=0,this.source=null,this.bufferSize=12,this.levelBuffer=new Array(this.bufferSize).fill(0),this.bufferIndex=0,this.interpolationFactor=.15,this.peakDecay=.92,this.peakLevel=0}catch(e){console.error("Error initializing AudioAnalyzer:",e)}}connectSource(e){try{this.source&&this.source.disconnect(),"suspended"===this.audioContext.state&&this.audioContext.resume(),this.source=this.audioContext.createMediaElementSource(e),this.source.connect(this.analyser),this.analyser.connect(this.audioContext.destination),console.log("Audio source connected successfully")}catch(t){console.error("Error connecting audio source:",t)}}getLevel(){try{const t=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteTimeDomainData(t);let n=0;for(let e=0;e<t.length;e++){const o=(t[e]-128)/128;n+=o*o}let o=Math.sqrt(n/t.length);this.peakLevel=Math.max(o,this.peakLevel*this.peakDecay),this.levelBuffer[this.bufferIndex]=o,this.bufferIndex=(this.bufferIndex+1)%this.bufferSize;const r=Array.from({length:this.bufferSize},(e,t)=>Math.exp(.2*-t)),a=r.reduce((e,t)=>e+t);let c=0;for(let e=0;e<this.bufferSize;e++){const t=(this.bufferIndex-e+this.bufferSize)%this.bufferSize;c+=this.levelBuffer[t]*r[e]}c/=a;const s=this.interpolationFactor,i=this.prevLevel+(c-this.prevLevel)*(1-Math.pow(1-s,3));return this.prevLevel=i,2.5*Math.pow(Math.max(i,.8*this.peakLevel),1.2)}catch(e){return console.error("Error getting audio level:",e),0}}}n(13);const l={CHAT_STATUS:"/api/status",CHAT_MESSAGE:"/api/chat/message",AUDIO_UPLOAD:"/api/audio",WEBSOCKET:"/ws"};var d=function(){const[e,t]=Object(o.useState)("Idle"),[n,a]=Object(o.useState)(""),[c,d]=Object(o.useState)(!1),h=Object(o.useRef)(null),f=Object(o.useRef)([]),[p,m]=Object(o.useState)(!1),[g,w]=Object(o.useState)(0),y=Object(o.useRef)(null),v=Object(o.useRef)(null),E=Object(o.useRef)(null),[b,A]=Object(o.useState)(!1),S=Object(o.useRef)(null);Object(o.useEffect)(()=>{fetch(l.CHAT_STATUS).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{t(e.message),console.log("Connection status:",e)}).catch(e=>{t("Connection Error"),console.error("Error:",e)})},[]);const C=async()=>{try{const n=await navigator.mediaDevices.getUserMedia({audio:!0});h.current=new MediaRecorder(n),f.current=[],(e=>{const t=new(window.AudioContext||window.webkitAudioContext),n=t.createAnalyser(),o=t.createMediaStreamSource(e);n.fftSize=32,o.connect(n),y.current=n;const r=()=>{const e=new Uint8Array(n.frequencyBinCount);n.getByteFrequencyData(e);const t=e.map((e,t)=>e*(t+1)),o=t.reduce((e,t)=>e+t,0)/t.length;w(o/128),v.current=requestAnimationFrame(r)};r()})(n),h.current.ondataavailable=(e=>{e.data.size>0&&f.current.push(e.data)}),h.current.onstop=(async()=>{const e=new Blob(f.current,{type:"audio/wav"});await k(e),w(0)}),h.current.start(),d(!0),t("Recording...")}catch(e){console.error("Error accessing microphone:",e),t("Error: "+e.message)}},x=e=>{try{const n=new Audio(e);return E.current=n,S.current&&S.current.connectSource(n),n.addEventListener("play",()=>{A(!0),console.log("Audio started playing")}),n.addEventListener("pause",()=>{A(!1),w(0),console.log("Audio paused")}),n.addEventListener("ended",()=>{A(!1),w(0),console.log("Audio ended")}),n}catch(t){return console.error("Error setting up audio:",t),null}},k=async e=>{const n=new FormData;n.append("audio",e,"recording.wav");try{const e=await fetch(l.AUDIO_UPLOAD,{method:"POST",body:n});if(!e.ok)throw new Error("Network response was not ok");const r=await e.json();if(console.log("Received response:",r),t(r.text||"Audio processed"),r.text&&a(r.text),r.audio_response){const e="data:audio/wav;base64,".concat(r.audio_response);console.log("Playing audio response");const t=x(e);await t.play().catch(e=>console.error("Error playing audio:",e))}else console.log("No audio response received")}catch(o){t("Error: "+o.message),console.error("Error sending audio:",o)}};return Object(o.useEffect)(()=>{S.current=new u;const e=()=>{E.current&&!E.current.paused&&w(S.current.getLevel()),v.current=requestAnimationFrame(e)};return e(),()=>{v.current&&cancelAnimationFrame(v.current)}},[]),r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"content-container"},r.a.createElement("div",{className:"visualizer-container"},r.a.createElement(i,{audioLevel:g,isActive:b})),r.a.createElement("div",{className:"controls-container"},r.a.createElement("input",{type:"text",id:"command-input",value:n,onChange:e=>a(e.target.value),onKeyPress:e=>{"Enter"===e.key&&n.trim()&&(async()=>{if(n.trim()){t("Sending...");try{const r=await fetch(l.CHAT_MESSAGE,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n.trim(),user_id:Object(s.a)(),session_id:Object(s.a)(),metadata:{}})});if(!r.ok)throw new Error("Network response was not ok");const a=await r.json();if(console.log("Response received:",a),t(a.message),a.audio_response){console.log("Audio response received, attempting to play...");const t="data:audio/wav;base64,".concat(a.audio_response),n=x(t);if(n)try{await n.play(),console.log("Audio playback started")}catch(e){console.error("Error playing audio:",e)}}else console.log("No audio response in data")}catch(o){t("Error: "+o.message),console.error("Error:",o)}}})()},placeholder:"Enter a command"}),r.a.createElement("button",{id:"mic-btn",onClick:()=>{c?h.current&&c&&(h.current.stop(),h.current.stream.getTracks().forEach(e=>e.stop()),d(!1),t("Processing audio...")):C()},title:"Record voice command",className:c?"recording":""},r.a.createElement("i",{className:"fas fa-microphone"})))))};var h=e=>{e&&e instanceof Function&&n.e(3).then(n.bind(null,17)).then(t=>{let{getCLS:n,getFID:o,getFCP:r,getLCP:a,getTTFB:c}=t;n(e),o(e),r(e),a(e),c(e)})};c.a.createRoot(document.getElementById("root")).render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(d,null))),h()},3:function(e,t,n){e.exports=n(14)}},[[3,1,2]]]);
//# sourceMappingURL=main.af5ad569.chunk.js.map